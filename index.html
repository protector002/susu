<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO Meta Tags (improved with targeted keywords) -->
  <title>SUSU: xxx, sex, and love videos - watch & download 18+ adult content</title>
  <meta name="description" content="SUSU is the ultimate destination for xxx, sex, and love videos. Watch and download high-quality 18+ adult content in 4K, 1080p, and HD. Updated daily with exclusive scenes.">
  <meta name="keywords" content="xxx, sex, love, adult videos, 18+ gallery, watch online, download HD, 4K video, SUSU, adult entertainment, erotic, sensual">
  <meta name="author" content="SUSU">
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  <meta name="revisit-after" content="1 day">
  <link rel="canonical" href="https://yourdomain.com">

  <!-- Open Graph / Facebook (improved) -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourdomain.com">
  <meta property="og:title" content="SUSU: xxx, sex, and love videos">
  <meta property="og:description" content="Discover the best xxx, sex, and love videos on SUSU. High-quality 18+ adult content in 4K and HD. Updated daily.">
  <meta property="og:image" content="https://yourdomain.com/og-image.jpg">
  <meta property="og:image:alt" content="SUSU video gallery preview featuring xxx, sex, and love videos">

  <!-- Twitter Card (improved) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="SUSU: xxx, sex, and love videos">
  <meta name="twitter:description" content="Watch and download the hottest xxx, sex, and love videos in stunning 4K and HD. Updated daily with exclusive adult content.">
  <meta name="twitter:image" content="https://yourdomain.com/og-image.jpg">
  <meta name="twitter:image:alt" content="SUSU video gallery preview featuring xxx, sex, and love videos">

  <!-- JSON-LD Structured Data (Website + VideoObject placeholder) -->
  <script type="application/ld+json" id="structured-data-website">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "SUSU Video Gallery",
      "url": "https://yourdomain.com",
      "description": "Modern video platform for xxx, sex, and love 18+ content",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://yourdomain.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
  <!-- Additional structured data for videos will be injected dynamically by JavaScript if needed -->

  <!-- Font Awesome 6 -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- modern font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ===== CSS variables for light/dark mode ===== */
    :root {
      --bg: #0a0c0f;
      --surface: #15181c;
      --surface-light: #1e2227;
      --text: #ffffff;
      --text-secondary: #9ca3af;
      --border: rgba(255,255,255,0.1);
      --accent: linear-gradient(135deg, #ff4d4d, #ff8c42);
      --accent-solid: #ff8c42;
      --toast-bg: #1e2227;
      --shadow: 0 20px 30px -10px rgba(255,77,77,0.2);
      --focus-outline: 3px solid #ff8c42;
    }

    body.light-mode {
      --bg: #f5f7fa;
      --surface: #ffffff;
      --surface-light: #f0f2f5;
      --text: #1a1e24;
      --text-secondary: #4b5563;
      --border: rgba(0,0,0,0.1);
      --accent: linear-gradient(135deg, #ff4d4d, #ff8c42);
      --accent-solid: #ff8c42;
      --toast-bg: #ffffff;
      --shadow: 0 20px 30px -10px rgba(255,77,77,0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s, border-color 0.2s;
    }

    /* Accessibility: focus styles */
    :focus-visible {
      outline: var(--focus-outline);
      outline-offset: 2px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* skip to main content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent-solid);
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 0 0 8px 0;
      z-index: 5000;
      transition: top 0.2s;
    }
    .skip-link:focus {
      top: 0;
      outline: none;
    }

    /* splash screen (accessible: hidden from screen readers when inactive) */
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0c0f;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.6s ease-out;
    }
    .splash-content { text-align: center; }
    .splash-18 {
      font-size: 3rem; font-weight: 700;
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      letter-spacing: 4px; margin-bottom: 1rem;
      opacity: 0; animation: fadeUp 0.5s ease forwards;
    }
    .splash-susu {
      font-size: 8rem; font-weight: 800;
      background: linear-gradient(135deg, #ffffff, #e0e0e0);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      letter-spacing: 8px; line-height: 1; margin: 0.5rem 0;
      opacity: 0; animation: fadeUp 0.5s ease 0.2s forwards;
    }
    .splash-bottom {
      display: flex; justify-content: center; gap: 2rem; margin-top: 2rem;
    }
    .splash-bottom span {
      font-size: 2rem; font-weight: 700;
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      opacity: 0; animation: fadeUp 0.5s ease 0.4s forwards;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* main content */
    #main-content {
      opacity: 0;
      transition: opacity 0.6s ease;
      max-width: 1440px;
      margin: 0 auto;
      padding: 2rem;
    }
    #main-content.visible { opacity: 1; }

    /* header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1.5rem 0; border-bottom: 1px solid var(--border);
      margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;
    }
    .logo {
      display: flex; align-items: center; gap: 1rem;
    }
    .logo h1 {
      font-size: 2.5rem; font-weight: 700;
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .logo span {
      background: rgba(255,255,255,0.1); padding: 0.3rem 1rem;
      border-radius: 30px; font-size: 0.9rem; font-weight: 600;
      color: #ff8c42; border: 1px solid rgba(255,140,66,0.3);
    }

    /* search */
    .search-container { flex: 1; max-width: 400px; min-width: 250px; }
    .search-box {
      display: flex; align-items: center; background: var(--surface);
      border: 1px solid var(--border); border-radius: 40px;
      padding: 0.4rem 0.4rem 0.4rem 1.2rem; transition: all 0.3s;
    }
    .search-box:focus-within {
      border-color: #ff8c42; box-shadow: 0 0 0 3px rgba(255,140,66,0.2);
    }
    .search-box i { color: var(--text-secondary); }
    .search-box input {
      flex: 1; background: transparent; border: none; padding: 0.6rem 0.8rem;
      color: var(--text); outline: none;
    }
    .search-box input::placeholder { color: var(--text-secondary); }
    .search-box button {
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      border: none; color: white; padding: 0.6rem 1.2rem;
      border-radius: 40px; font-weight: 600; cursor: pointer;
      transition: opacity 0.2s;
    }
    /* Label for search (hidden visually but available for screen readers) */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      margin: -1px;
      padding: 0;
      overflow: hidden;
      clip: rect(0,0,0,0);
      border: 0;
    }

    /* theme toggle & filters */
    .theme-toggle {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 40px; padding: 0.6rem 1.2rem; cursor: pointer;
      display: flex; align-items: center; gap: 8px;
    }
    .filters { display: flex; gap: 0.8rem; flex-wrap: wrap; }
    .filter-btn {
      background: var(--surface); border: 1px solid var(--border);
      color: var(--text); padding: 0.6rem 1.2rem; border-radius: 30px;
      font-size: 0.9rem; font-weight: 500; cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover { border-color: #ff8c42; }
    .filter-btn.active {
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      border: none; color: white;
    }
    .filter-btn[aria-selected="true"] {
      background: linear-gradient(135deg, #ff4d4d, #ff8c42);
      border: none; color: white;
    }

    /* SEO intro paragraph (visible, keyword-rich) */
    .seo-intro {
      margin: 1rem 0 2rem;
      padding: 1rem;
      background: var(--surface);
      border-left: 4px solid #ff8c42;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .seo-intro strong {
      color: #ff8c42;
    }

    /* video grid */
    .video-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem; margin: 2rem 0 3rem;
    }
    .skeleton-card {
      background: var(--surface); border-radius: 16px; padding: 1rem;
      height: 320px; animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    .video-card {
      background: var(--surface); border-radius: 16px; overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s; border: 1px solid var(--border);
      cursor: pointer; opacity: 0; animation: cardFadeIn 0.5s forwards;
    }
    @keyframes cardFadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .video-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow); border-color: rgba(255,140,66,0.4);
    }
    .thumbnail-wrapper { position: relative; aspect-ratio: 16/9; background: var(--surface-light); }
    .thumbnail-wrapper video { width: 100%; height: 100%; object-fit: cover; }
    .duration {
      position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8);
      color: white; padding: 0.2rem 0.6rem; border-radius: 6px; font-size: 0.8rem;
    }
    .video-info { padding: 1.5rem; }
    .video-title {
      font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem;
      display: flex; align-items: center; justify-content: space-between;
    }
    .video-title .actions {
      display: flex; gap: 0.8rem;
    }
    .video-title i {
      cursor: pointer; transition: 0.2s;
    }
    .video-title i.fa-star { color: #ffd700; }
    .video-title i.fa-heart { color: #ff4d4d; }
    .video-description { color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem; }
    .meta-row {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1rem;
    }
    .quality {
      background: rgba(255,140,66,0.1); color: #ff8c42; padding: 0.2rem 0.8rem;
      border-radius: 20px; font-size: 0.75rem; font-weight: 600;
    }
    .size { color: var(--text-secondary); font-size: 0.8rem; }
    .tags {
      display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;
    }
    .tag {
      background: var(--surface-light); color: var(--text-secondary);
      padding: 0.2rem 0.8rem; border-radius: 20px; font-size: 0.7rem;
    }
    .action-row {
      display: flex; gap: 0.8rem;
    }
    .watch-btn, .download-btn {
      flex: 1; display: flex; align-items: center; justify-content: center;
      gap: 8px; padding: 0.8rem; border-radius: 10px; font-weight: 600;
      text-decoration: none; transition: all 0.2s; border: none;
    }
    .watch-btn {
      background: linear-gradient(135deg, #ff4d4d, #ff8c42); color: white;
    }
    .watch-btn:hover { opacity: 0.9; transform: scale(1.02); }
    .download-btn {
      background: var(--surface-light); border: 1px solid var(--border); color: var(--text);
    }
    .download-btn:hover { background: rgba(255,140,66,0.2); border-color: #ff8c42; }

    /* pagination */
    .pagination {
      display: flex; justify-content: center; gap: 1rem; margin: 2rem 0;
    }
    .page-btn {
      background: var(--surface); border: 1px solid var(--border);
      padding: 0.5rem 1.2rem; border-radius: 30px; cursor: pointer;
    }
    .page-btn.active { background: #ff8c42; color: black; border-color: #ff8c42; }
    .page-btn[aria-current="page"] {
      background: #ff8c42; color: black; border-color: #ff8c42;
    }

    /* modal (improved accessibility) */
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 3000; align-items: center; justify-content: center;
    }
    .modal.active { display: flex; }
    .modal[aria-hidden="true"] { display: none; }
    .modal[aria-hidden="false"] { display: flex; }
    .modal-content {
      background: var(--surface); max-width: 800px; width: 90%; border-radius: 20px;
      padding: 2rem; max-height: 90vh; overflow-y: auto;
      position: relative;
    }
    .modal-video { width: 100%; aspect-ratio: 16/9; margin-bottom: 1rem; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .modal-close {
      font-size: 2rem; cursor: pointer; color: var(--text-secondary);
      background: none; border: none; padding: 0.5rem;
    }
    .rating-stars {
      display: flex; gap: 0.5rem; margin: 1rem 0; font-size: 1.5rem;
      color: #ffd700; cursor: pointer;
    }
    .comments-section { margin-top: 2rem; }
    .comment {
      border-bottom: 1px solid var(--border); padding: 1rem 0;
    }
    .comment-author { font-weight: 600; margin-bottom: 0.2rem; }
    .comment-text { color: var(--text-secondary); }
    .add-comment {
      display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;
    }
    .add-comment input, .add-comment textarea {
      background: var(--surface-light); border: 1px solid var(--border);
      color: var(--text); padding: 0.5rem; border-radius: 8px; flex: 1 1 200px;
    }
    .add-comment button {
      background: #ff8c42; border: none; color: white; padding: 0.5rem 1rem;
      border-radius: 8px; cursor: pointer;
    }

    /* toast (live region) */
    .toast {
      position: fixed; bottom: 20px; right: 20px; background: var(--toast-bg);
      border-left: 4px solid #ff8c42; padding: 1rem 1.5rem; border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 4000;
      transform: translateX(120%); transition: transform 0.3s;
    }
    .toast.show { transform: translateX(0); }

    /* footer */
    .footer {
      margin-top: 4rem; padding: 2rem 0; border-top: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      color: var(--text-secondary); flex-wrap: wrap; gap: 1rem;
    }
    .footer-links { display: flex; gap: 2rem; }
    .footer-links a {
      color: var(--text-secondary); text-decoration: none; cursor: pointer;
    }
    .footer-links a:hover { color: #ff8c42; }
    .age-badge {
      background: rgba(255,77,77,0.2); border: 1px solid rgba(255,77,77,0.3);
      color: #ff4d4d; padding: 0.3rem 1.5rem; border-radius: 30px;
    }

    @media (max-width: 700px) {
      .splash-susu { font-size: 5rem; }
      .header { flex-direction: column; align-items: stretch; }
      .search-container { max-width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Skip to main content link for keyboard users -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div id="splash" role="presentation" aria-hidden="true">
    <div class="splash-content">
      <div class="splash-18" aria-hidden="true">18+</div>
      <div class="splash-susu" aria-hidden="true">SUSU</div>
      <div class="splash-bottom" aria-hidden="true"><span>18+</span><span>18+</span></div>
    </div>
  </div>

  <main id="main-content" aria-label="Main content">
    <div class="header" role="banner">
      <div class="logo">
        <h1>SUSU</h1>
        <span aria-label="Adult content 18+">18+</span>
      </div>
      <div class="search-container" role="search">
        <label for="searchInput" class="visually-hidden">Search videos</label>
        <div class="search-box">
          <i class="fa-solid fa-search" aria-hidden="true"></i>
          <input type="text" id="searchInput" placeholder="Search videos...">
          <button id="searchBtn" aria-label="Search"><i class="fa-solid fa-arrow-right" aria-hidden="true"></i></button>
        </div>
      </div>
      <div class="theme-toggle" id="themeToggle" role="button" tabindex="0" aria-pressed="false" aria-label="Switch between dark and light mode">
        <i class="fa-regular fa-moon" aria-hidden="true"></i> Dark
      </div>
    </div>

    <!-- SEO intro paragraph with targeted keywords -->
    <div class="seo-intro">
      <p><strong>Welcome to SUSU</strong> â€“ your premium destination for <strong>xxx</strong>, <strong>sex</strong>, and <strong>love</strong> videos. Explore our vast collection of high-quality 18+ adult content in 4K, 1080p, and HD. Updated daily with exclusive scenes, we bring you the best in adult entertainment. Whether you're looking for passionate love stories or intense xxx action, SUSU has it all. Enjoy seamless streaming and fast downloads, all in a modern, user-friendly interface. Join thousands of satisfied viewers and discover your next favorite video today.</p>
    </div>

    <!-- filters (All and Favorites) -->
    <nav class="filters" aria-label="Video filters">
      <button class="filter-btn active" data-filter="all" aria-selected="true">All</button>
      <button class="filter-btn" data-filter="favorites" aria-selected="false"><i class="fa-regular fa-star" aria-hidden="true"></i> Favorites</button>
    </nav>

    <!-- video grid -->
    <section aria-labelledby="video-gallery-heading">
      <h2 id="video-gallery-heading" class="visually-hidden">Video Gallery</h2>
      <div id="video-gallery" class="video-grid">
        <!-- skeleton will be shown while loading -->
      </div>
    </section>

    <!-- pagination -->
    <nav aria-label="Pagination">
      <div class="pagination" id="pagination"></div>
    </nav>

    <!-- footer -->
    <footer class="footer" role="contentinfo">
      <div class="footer-links">
        <a onclick="document.querySelectorAll('video').forEach(v=>v.play()); return false;" role="button" tabindex="0" aria-label="Play all videos"><i class="fa-solid fa-play" aria-hidden="true"></i> play all</a>
        <a onclick="document.querySelectorAll('video').forEach(v=>v.pause()); return false;" role="button" tabindex="0" aria-label="Pause all videos"><i class="fa-solid fa-pause" aria-hidden="true"></i> pause all</a>
        <a onclick="document.querySelectorAll('video').forEach(v=>{ v.pause(); v.currentTime=0; }); return false;" role="button" tabindex="0" aria-label="Reset all videos"><i class="fa-solid fa-rotate-left" aria-hidden="true"></i> reset</a>
      </div>
      <div class="age-badge" aria-label="Adult content 18+">18+</div>
    </footer>
  </main>

  <!-- video detail modal (improved accessibility) -->
  <div id="videoModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle"></h2>
        <button class="modal-close" id="closeModal" aria-label="Close modal">&times;</button>
      </div>
      <video id="modalVideo" class="modal-video" controls aria-label="Video player"></video>
      <div id="modalDescription" class="video-description"></div>
      <div class="meta-row">
        <span id="modalQuality" class="quality"></span>
        <span id="modalSize" class="size"></span>
      </div>
      <div class="tags" id="modalTags"></div>
      <div class="rating-stars" id="ratingStars" role="radiogroup" aria-label="Rate this video">
        <i class="fa-regular fa-star" data-rating="1" role="radio" aria-checked="false" tabindex="0" aria-label="1 star"></i>
        <i class="fa-regular fa-star" data-rating="2" role="radio" aria-checked="false" tabindex="0" aria-label="2 stars"></i>
        <i class="fa-regular fa-star" data-rating="3" role="radio" aria-checked="false" tabindex="0" aria-label="3 stars"></i>
        <i class="fa-regular fa-star" data-rating="4" role="radio" aria-checked="false" tabindex="0" aria-label="4 stars"></i>
        <i class="fa-regular fa-star" data-rating="5" role="radio" aria-checked="false" tabindex="0" aria-label="5 stars"></i>
      </div>
      <div class="comments-section" id="commentsSection">
        <h3>Comments</h3>
        <div id="commentsList" aria-live="polite"></div>
        <div class="add-comment">
          <label for="commentName" class="visually-hidden">Your name</label>
          <input type="text" id="commentName" placeholder="Your name">
          <label for="commentText" class="visually-hidden">Your comment</label>
          <textarea id="commentText" placeholder="Your comment"></textarea>
          <button id="postComment">Post</button>
        </div>
      </div>
    </div>
  </div>

  <!-- toast notification (live region) -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function() {
      // ========== DATA & STATE ==========
      let allVideos = [];
      let filteredVideos = [];
      let currentPage = 1;
      const pageSize = 6;
      let favorites = JSON.parse(localStorage.getItem('susu_favorites')) || [];
      let likes = JSON.parse(localStorage.getItem('susu_likes')) || [];
      let ratings = JSON.parse(localStorage.getItem('susu_ratings')) || {};
      let comments = JSON.parse(localStorage.getItem('susu_comments')) || {};
      let currentVideoId = null;
      let currentFilter = 'all';
      let searchTerm = '';

      const splash = document.getElementById('splash');
      const mainContent = document.getElementById('main-content');
      const gallery = document.getElementById('video-gallery');
      const paginationDiv = document.getElementById('pagination');
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');
      const themeToggle = document.getElementById('themeToggle');
      const modal = document.getElementById('videoModal');
      const closeModal = document.getElementById('closeModal');
      const modalVideo = document.getElementById('modalVideo');
      const modalTitle = document.getElementById('modalTitle');
      const modalDescription = document.getElementById('modalDescription');
      const modalQuality = document.getElementById('modalQuality');
      const modalSize = document.getElementById('modalSize');
      const modalTags = document.getElementById('modalTags');
      const ratingStars = document.getElementById('ratingStars');
      const commentsList = document.getElementById('commentsList');
      const commentName = document.getElementById('commentName');
      const commentText = document.getElementById('commentText');
      const postComment = document.getElementById('postComment');
      const toast = document.getElementById('toast');
      const filterButtons = document.querySelectorAll('.filter-btn');

      // ========== HELPER FUNCTIONS ==========
      function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
      }

      // generate poster with alt text
      function generatePosterURL(title) {
        const colors = [['#ff4d4d','#ff8c42'],['#4158D0','#C850C0'],['#0093E9','#80D0C7']];
        const hash = title.split('').reduce((a,b)=>a+b.charCodeAt(0),0);
        const [c1,c2] = colors[hash % colors.length];
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 360"><defs><linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></linearGradient></defs><rect width="640" height="360" fill="url(#g)"/><text x="320" y="180" font-family="Inter" font-size="48" fill="white" text-anchor="middle" dy=".3em">${title}</text><text x="320" y="240" font-size="24" fill="rgba(255,255,255,0.7)" text-anchor="middle">SUSU</text></svg>`;
        return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
      }

      // simulate tags/categories
      function getRandomTags() {
        const allTags = ['action','comedy','drama','trailer','music','sports'];
        return allTags.sort(()=>0.5-Math.random()).slice(0,2);
      }

      // ========== LOAD VIDEOS FROM API ==========
      async function loadVideos() {
        gallery.innerHTML = Array(6).fill(0).map(() => '<div class="skeleton-card" aria-label="Loading video"></div>').join('');
        try {
          const res = await fetch('https://nhvqrzbgyxqtlxerjtse.supabase.co/functions/v1/get-videos');
          const data = await res.json();
          allVideos = (data.videos || []).map(v => ({
            ...v,
            tags: getRandomTags(),
            quality: ['4K','1080p','720p','HD'][v.title.length % 4],
            size: ['1.2 GB','850 MB','450 MB','1.8 GB'][v.title.length % 4],
            duration: '10:34',
            rating: ratings[v.url] || 0,
          }));
          applyFilters();
        } catch (e) {
          gallery.innerHTML = '<div class="loading-message" role="alert">Failed to load videos</div>';
        }
      }

      // ========== FILTER + SEARCH ==========
      function applyFilters() {
        let filtered = allVideos;

        // search
        if (searchTerm) {
          filtered = filtered.filter(v => v.title.toLowerCase().includes(searchTerm.toLowerCase()));
        }

        // favorites filter
        if (currentFilter === 'favorites') {
          filtered = filtered.filter(v => favorites.includes(v.url));
        }

        filteredVideos = filtered;
        currentPage = 1;
        renderCurrentPage();
        updateFilterButtons();
      }

      function updateFilterButtons() {
        filterButtons.forEach(btn => {
          const isActive = btn.dataset.filter === currentFilter;
          btn.setAttribute('aria-selected', isActive);
          if (isActive) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
      }

      function renderCurrentPage() {
        const start = (currentPage - 1) * pageSize;
        const pageVideos = filteredVideos.slice(start, start + pageSize);
        const totalPages = Math.ceil(filteredVideos.length / pageSize);

        if (filteredVideos.length === 0) {
          gallery.innerHTML = '<div class="loading-message" role="status">No videos found</div>';
        } else {
          gallery.innerHTML = pageVideos.map(v => {
            const isFav = favorites.includes(v.url);
            const isLiked = likes.includes(v.url);
            return `
              <article class="video-card" data-url="${v.url}" aria-labelledby="title-${v.url.replace(/[^a-zA-Z0-9]/g, '')}">
                <div class="thumbnail-wrapper">
                  <video preload="metadata" poster="${generatePosterURL(v.title)}" aria-label="Thumbnail for ${v.title}">
                    <source src="${v.url}" type="${v.mime_type || 'video/mp4'}">
                  </video>
                  <span class="duration" aria-hidden="true">${v.quality}</span>
                </div>
                <div class="video-info">
                  <div class="video-title">
                    <span id="title-${v.url.replace(/[^a-zA-Z0-9]/g, '')}">${v.title}</span>
                    <div class="actions">
                      <i class="${isFav ? 'fa-solid fa-star' : 'fa-regular fa-star'}" data-fav="true" data-url="${v.url}" role="button" tabindex="0" aria-label="${isFav ? 'Remove from favorites' : 'Add to favorites'}"></i>
                      <i class="${isLiked ? 'fa-solid fa-heart' : 'fa-regular fa-heart'}" data-like="true" data-url="${v.url}" role="button" tabindex="0" aria-label="${isLiked ? 'Unlike' : 'Like'}"></i>
                    </div>
                  </div>
                  <div class="video-description">${v.description || ''}</div>
                  <div class="meta-row">
                    <span class="quality">${v.quality}</span>
                    <span class="size">${v.size}</span>
                  </div>
                  <div class="tags" aria-label="Tags">
                    ${v.tags.map(t => `<span class="tag">#${t}</span>`).join('')}
                  </div>
                  <div class="action-row">
                    <a href="#" class="watch-btn" data-play aria-label="Watch ${v.title}"><i class="fa-solid fa-play" aria-hidden="true"></i> Watch</a>
                    <a href="${v.url}" download class="download-btn" target="_blank" aria-label="Download ${v.title}"><i class="fa-solid fa-download" aria-hidden="true"></i> Download</a>
                  </div>
                </div>
              </article>
            `;
          }).join('');
        }

        // pagination
        let paginationHtml = '';
        for (let i = 1; i <= totalPages; i++) {
          const ariaCurrent = i === currentPage ? 'page' : 'false';
          paginationHtml += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}" aria-label="Page ${i}" aria-current="${ariaCurrent}">${i}</button>`;
        }
        paginationDiv.innerHTML = paginationHtml;

        attachCardEvents();
      }

      function attachCardEvents() {
        // favorite toggle
        document.querySelectorAll('.video-title i[data-fav]').forEach(star => {
          star.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleFavorite(star);
          });
          star.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              toggleFavorite(star);
            }
          });
        });

        function toggleFavorite(star) {
          const url = star.dataset.url;
          if (favorites.includes(url)) {
            favorites = favorites.filter(f => f !== url);
            star.classList.remove('fa-solid', 'fa-star');
            star.classList.add('fa-regular', 'fa-star');
            star.setAttribute('aria-label', 'Add to favorites');
            showToast('Removed from favorites');
          } else {
            favorites.push(url);
            star.classList.remove('fa-regular');
            star.classList.add('fa-solid', 'fa-star');
            star.setAttribute('aria-label', 'Remove from favorites');
            showToast('Added to favorites');
          }
          localStorage.setItem('susu_favorites', JSON.stringify(favorites));
        }

        // like toggle
        document.querySelectorAll('.video-title i[data-like]').forEach(heart => {
          heart.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleLike(heart);
          });
          heart.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              toggleLike(heart);
            }
          });
        });

        function toggleLike(heart) {
          const url = heart.dataset.url;
          if (likes.includes(url)) {
            likes = likes.filter(l => l !== url);
            heart.classList.remove('fa-solid', 'fa-heart');
            heart.classList.add('fa-regular', 'fa-heart');
            heart.setAttribute('aria-label', 'Like');
            showToast('Removed like');
          } else {
            likes.push(url);
            heart.classList.remove('fa-regular');
            heart.classList.add('fa-solid', 'fa-heart');
            heart.setAttribute('aria-label', 'Unlike');
            showToast('Liked!');
          }
          localStorage.setItem('susu_likes', JSON.stringify(likes));
        }

        // open modal on card click (except icons & buttons)
        document.querySelectorAll('.video-card').forEach(card => {
          card.addEventListener('click', (e) => {
            if (e.target.closest('i[data-fav]') || e.target.closest('i[data-like]') || e.target.closest('.watch-btn') || e.target.closest('.download-btn')) return;
            const url = card.dataset.url;
            const video = allVideos.find(v => v.url === url);
            if (video) openModal(video);
          });
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              const url = card.dataset.url;
              const video = allVideos.find(v => v.url === url);
              if (video) openModal(video);
            }
          });
        });

        // watch button triggers modal
        document.querySelectorAll('.watch-btn[data-play]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            const card = btn.closest('.video-card');
            const url = card.dataset.url;
            const video = allVideos.find(v => v.url === url);
            if (video) openModal(video);
          });
        });

        // pagination
        document.querySelectorAll('.page-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            currentPage = parseInt(btn.dataset.page);
            renderCurrentPage();
            window.scrollTo({ top: 0, behavior: 'smooth' });
          });
        });
      }

      // ========== MODAL ==========
      function openModal(video) {
        currentVideoId = video.url;
        modalTitle.textContent = video.title;
        modalDescription.textContent = video.description || '';
        modalQuality.textContent = video.quality;
        modalSize.textContent = video.size;
        modalTags.innerHTML = video.tags.map(t => `<span class="tag">#${t}</span>`).join('');
        modalVideo.innerHTML = `<source src="${video.url}" type="${video.mime_type || 'video/mp4'}">`;
        modalVideo.load();

        // ratings
        const currentRating = ratings[video.url] || 0;
        const stars = ratingStars.querySelectorAll('i');
        stars.forEach((s, idx) => {
          if (idx < currentRating) {
            s.className = 'fa-solid fa-star';
            s.setAttribute('aria-checked', 'true');
          } else {
            s.className = 'fa-regular fa-star';
            s.setAttribute('aria-checked', 'false');
          }
        });

        // comments
        loadComments(video.url);

        modal.setAttribute('aria-hidden', 'false');
        modal.classList.add('active');
        // focus on modal close button for accessibility
        closeModal.focus();
        // trap focus within modal (simplified, but you could add a focus trap)
      }

      function loadComments(videoId) {
        const videoComments = comments[videoId] || [];
        commentsList.innerHTML = videoComments.map(c => `
          <div class="comment">
            <div class="comment-author">${c.name}</div>
            <div class="comment-text">${c.text}</div>
          </div>
        `).join('') || '<p>No comments yet.</p>';
      }

      // ========== EVENT LISTENERS ==========
      // search
      searchBtn.addEventListener('click', () => {
        searchTerm = searchInput.value;
        applyFilters();
      });
      searchInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') searchBtn.click(); });

      // filters
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          currentFilter = btn.dataset.filter;
          applyFilters();
        });
      });

      // theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      themeToggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggleTheme();
        }
      });

      function toggleTheme() {
        document.body.classList.toggle('light-mode');
        const isLight = document.body.classList.contains('light-mode');
        themeToggle.innerHTML = isLight ? '<i class="fa-regular fa-sun" aria-hidden="true"></i> Light' : '<i class="fa-regular fa-moon" aria-hidden="true"></i> Dark';
        themeToggle.setAttribute('aria-pressed', isLight);
      }

      // modal close
      closeModal.addEventListener('click', closeModalHandler);
      window.addEventListener('click', (e) => { if (e.target === modal) closeModalHandler(); });
      window.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('active')) closeModalHandler(); });

      function closeModalHandler() {
        modal.setAttribute('aria-hidden', 'true');
        modal.classList.remove('active');
        modalVideo.pause();
        // return focus to the element that opened modal? optional.
      }

      // rating stars
      ratingStars.querySelectorAll('i').forEach(star => {
        star.addEventListener('click', () => {
          setRating(parseInt(star.dataset.rating));
        });
        star.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            setRating(parseInt(star.dataset.rating));
          }
        });
      });

      function setRating(rating) {
        ratings[currentVideoId] = rating;
        localStorage.setItem('susu_ratings', JSON.stringify(ratings));
        const stars = ratingStars.querySelectorAll('i');
        stars.forEach((s, idx) => {
          if (idx < rating) {
            s.className = 'fa-solid fa-star';
            s.setAttribute('aria-checked', 'true');
          } else {
            s.className = 'fa-regular fa-star';
            s.setAttribute('aria-checked', 'false');
          }
        });
        showToast('Rating saved');
      }

      // post comment
      postComment.addEventListener('click', () => {
        if (!commentName.value.trim() || !commentText.value.trim()) {
          showToast('Fill in name and comment');
          return;
        }
        const newComment = { name: commentName.value, text: commentText.value };
        if (!comments[currentVideoId]) comments[currentVideoId] = [];
        comments[currentVideoId].push(newComment);
        localStorage.setItem('susu_comments', JSON.stringify(comments));
        loadComments(currentVideoId);
        commentName.value = '';
        commentText.value = '';
        showToast('Comment added');
      });

      // ========== INIT ==========
      function showMain() {
        splash.style.opacity = '0';
        splash.setAttribute('aria-hidden', 'true');
        setTimeout(() => {
          splash.style.display = 'none';
          mainContent.classList.add('visible');
          mainContent.setAttribute('aria-hidden', 'false');
        }, 600);
      }

      // Initially hide splash from screen readers after load
      splash.setAttribute('aria-hidden', 'false');
      mainContent.setAttribute('aria-hidden', 'true');

      loadVideos();
      setTimeout(showMain, 800);
    })();
  </script>

<!-- ========== ADDED TRACKING SCRIPTS ========== -->
<!-- Visitor Tracking (Supabase) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const sb = window.supabase.createClient(
  'https://nhvqrzbgyxqtlxerjtse.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5odnFyemJneXhxdGx4ZXJqdHNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4ODcyNjksImV4cCI6MjA4NzQ2MzI2OX0.zhdhmKHmGKAhU-uMAWiSr-gCc52Bks8-Xh-C8JEITZA'
);

// Generate a simple device fingerprint
async function getFingerprint() {
  const raw = [
    navigator.userAgent,
    navigator.language,
    screen.width + 'x' + screen.height,
    screen.colorDepth,
    Intl.DateTimeFormat().resolvedOptions().timeZone,
    navigator.hardwareConcurrency
  ].join('|');
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(raw));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

(async () => {
  const fp = await getFingerprint();
  // Check if visitor already exists
  const { data: existing } = await sb.from('visitors').select('id, visit_count').eq('fingerprint', fp).maybeSingle();
  if (existing) {
    await sb.from('visitors').update({ last_visit_at: new Date().toISOString(), visit_count: existing.visit_count + 1 }).eq('id', existing.id);
    window.__visitor_id = existing.id;
  } else {
    const { data: newV } = await sb.from('visitors').insert({
      fingerprint: fp,
      user_agent: navigator.userAgent,
      platform: navigator.platform,
      language: navigator.language,
      screen_width: screen.width,
      screen_height: screen.height
    }).select('id').single();
    if (newV) window.__visitor_id = newV.id;
  }
})();
</script>

<!-- Video Play Tracking (using event delegation) -->
<script>
function trackVideoPlay(videoId) {
  if (window.__visitor_id) {
    sb.from('video_plays').insert({
      visitor_id: window.__visitor_id,
      video_id: videoId
    });
  }
}

// Listen for 'play' events on any video element (including dynamically added ones)
document.addEventListener('play', function(e) {
  const video = e.target;
  if (video.tagName === 'VIDEO') {
    // Try to get videoId from data-video-id attribute (fallback to src)
    let videoId = video.getAttribute('data-video-id');
    if (!videoId && video.currentSrc) {
      // Use the video URL as a simple identifier (or you could map it)
      videoId = video.currentSrc;
    }
    if (videoId) {
      trackVideoPlay(videoId);
    }
  }
}, true); // use capture to ensure it runs before other handlers
</script>
</body>
</html>
